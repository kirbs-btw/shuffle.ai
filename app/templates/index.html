<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shuffle.ai</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>

<body>
    <div class="nav-section">
        <div class="search-bar">
            <input list="song-suggestions" type="text" id="search-input">
            <!-- example how to get suggestions to work-->
            <datalist id="song-suggestions"></datalist>
            <button id="search-button" onclick="addSongFromInput()">search</button>
        </div>
    </div>

    <div class="playlist-section">
        <h1 id="playlist_title">love songs</h1>
        <!-- list of the songs added to the playlist -->
        <div class="playlist-container" id="playlist-div-id">
            <!-- playlist item-->
            <!--<div class="song-container">
                <div class="start-song-div">
                    <p class="start-song-section"><b>Perfect</b>- Ed Sheeran</p>
                </div>
                <div class="middle-song-div">
                    <p class="middle-song-section">34.002</p>
                </div>
                <div class="end-song-div">
                    <button class="end-song-section add-song-button">-</button>
                </div>
            </div> -->
            <!-- splitting the song sections in 3 parts to have an even spacing -->
        </div>
    </div>
    <div class="suggestions-section">
        <h1 id="playlist_title">suggestions</h1>
        <div class="suggestion-container">
            <div class="song-container">
                <div class="start-song-div">
                    <p class="start-song-section"><b>Castle On the Hill </b> - Ed Sheeran</p>
                </div>
                <div class="middle-song-div">
                    <p class="middle-song-section">34.002</p>
                </div>
                <div class="end-song-div"><button class="end-song-section add-song-button">+</button></div>
            </div>
        </div>
        <!-- list of the songs suggestions-->
    </div>
</body>
<script>
    // song suggestions
    function sendInput(input_data) {
        fetch('/word_search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    input: input_data
                })
            })
            .then(response => response.json())
            .then(data => {
                // clearing datalist
                const datalist = document.getElementById("song-suggestions");
                while (datalist.firstChild) {
                    datalist.removeChild(datalist.firstChild);
                }

                json_array_songs = data.data;
                json_array_songs.forEach(element => {
                    const option = document.createElement('option');
                    option.value = element.track_name + " " + element.track_id;
                    datalist.appendChild(option);
                });
            });
    }

    document.getElementById('search-input').addEventListener('input', function(event) {
        console.log('Current value:', event.target.value);
        sendInput(event.target.value);
    });

    // add song to playlist visualy
    function addSong(title, artist, song_id) {
        var songHTML = `<div class="song-container" id="${song_id}"> <div class="start-song-div">  <p class="start-song-section"><b>${title}</b>- ${artist}</p> </div> <div class="middle-song-div"> <p class="middle-song-section">34.002</p> </div> <div class="end-song-div"> <button class="end-song-section add-song-button" value="${song_id}" onclick="removeSong(this.value)">-</button> </div> </div>`;
        document.getElementById("playlist-div-id").innerHTML += songHTML;
    }

    function removeSongFromDiv(song_id) {
        document.getElementById(song_id).remove();
    }

    function addSongFromInput() {
        var strInput = document.getElementById("search-input").value;
        console.log(strInput);
        var the_song_id = strInput.slice(-36);

        // adding the entry to the playlist div and the list in python api 
        fetch('/add_song_to_playlist', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    song_id: the_song_id
                })
            })
            .then(response => response.json())
            .then(data => {
                track_name = data.track_name;
                track_artist = data.track_artist;
                track_id = data.track_id;
                // adding song to playlist div
                addSong(track_name, track_artist, track_id);
            });

    }

    function removeSong(the_song_id) {
        fetch('/remove_song', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    song_id: the_song_id
                })
            })
            .then(response => response.json())
            .then(data => {
                // remove the song from the ui
                removeSongFromDiv(the_song_id);
            });

    }
</script>

</html>